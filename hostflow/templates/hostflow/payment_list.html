{% extends 'hostflow/base.html' %}
{% block title %}Payments{% endblock %}
{% block page_title %}Payment Records{% endblock %}
{% block content %}
<div class="d-flex justify-content-end mb-3">
  <a href="{% url 'export_csv' %}" class="btn btn-outline-success btn-sm">⬇ Export CSV</a>
</div>
<div class="card">
  <table class="table table-hover mb-0">
    <thead class="table-light"><tr>
      <th>Tenant</th><th>Unit</th><th>Due</th><th>Paid</th><th>Late Fee</th><th>Due Date</th><th>Status</th><th>Actions</th>
    </tr></thead>
    <tbody>
    {% for p in payments %}
    <tr>
      <td>{{ p.lease.tenant.username }}</td>
      <td>{{ p.lease.unit.unit_number }}</td>
      <td>₹{{ p.amount_due }}</td>
      <td>₹{{ p.amount_paid }}</td>
      <td>{% if p.late_fee > 0 %}<span class="text-danger">₹{{ p.late_fee }}</span>{% else %}—{% endif %}</td>
      <td>{{ p.due_date }}</td>
      <td>
        {% if p.status == 'paid' %}<span class="badge bg-success">Paid</span>
        {% elif p.status == 'overdue' %}<span class="badge bg-danger">Overdue</span>
        {% elif p.status == 'partial' %}<span class="badge bg-warning text-dark">Partial</span>
        {% else %}<span class="badge bg-secondary">Pending</span>{% endif %}
      </td>
      <td>
        <a href="{% url 'download_receipt' p.pk %}" class="btn btn-outline-secondary btn-sm">Receipt</a>
      </td>
    </tr>
    {% empty %}
    <tr><td colspan="8" class="text-center text-muted py-4">No payment records.</td></tr>
    {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
